name: S3 Bucket Region Compliance
service_type: object-storage
requirement_text: >
  When the service is running, its region and availability zone MUST be included 
  in a list of explicitly trusted or approved locations within the trust perimeter.

validity_score: 8
validity_commentary: >
  This query validates that S3 buckets are deployed in approved regions.
  S3 buckets are regional resources, making region validation straightforward.
  Strengths:
  - Directly queries bucket location
  - S3 bucket region cannot be changed after creation
  - Easy to validate against an approved region list
  Limitations:
  - Approved regions must be defined externally (not in this query)
  - Does not validate S3 access points or Multi-Region Access Points
  - Cross-region replication destinations are checked separately (CN10)

query: |
  aws s3api get-bucket-location \
    --bucket ${BUCKET_NAME}

rules:
  - jsonpath: "$.LocationConstraint"
    expected_values:
      - "us-east-1"
      - "us-east-2"
      - "us-west-1"
      - "us-west-2"
      - "eu-west-1"
      - "eu-central-1"
    validation_rule: "^(us-east-1|us-east-2|us-west-1|us-west-2|eu-west-1|eu-central-1|null)$"
    todo: Replace with parameterised list of approved regions
    description: >
      Validates that the bucket is located in an approved region. Note that
      us-east-1 returns null for LocationConstraint. The expected_values list
      should be customized to match your organization's approved regions.
