name: Azure Storage Replication Status Visibility
service_type: object-storage
requirement_text: >
  When data is replicated into a second location, the service MUST be able to
  accurately represent the replication locations, replication status, and data
  synchronization status.

validity_score: 8
validity_commentary: >
  This query validates that Azure Storage geo-replication status is visible.
  Azure Storage provides automatic geo-replication with status reporting.
  Strengths:
  - Secondary location is visible in account properties
  - Replication status is automatically tracked
  - Last sync time available for RA-GRS/RA-GZRS
  Limitations:
  - Replication lag is not guaranteed
  - Detailed sync metrics require Azure Monitor

query: |
  az storage account show \
    --name ${AzureStorageAccount} \
    --resource-group ${AzureResourceGroup} \
    --query "{sku: sku.name, primaryLocation: primaryLocation, secondaryLocation: secondaryLocation, statusOfPrimary: statusOfPrimary, statusOfSecondary: statusOfSecondary, lastGeoFailoverTime: geoReplicationStats.lastSyncTime}" \
    --output json

rules:
  - jsonpath: "$.secondaryLocation"
    expected_values: []
    validation_rule: "^[a-z]+$"
    description: >
      Validates that a secondary location is configured and visible,
      indicating geo-replication is active.

  - jsonpath: "$.statusOfSecondary"
    expected_values:
      - "available"
    validation_rule: "^(available|unavailable)$"
    description: >
      Validates that the secondary region status is reported, providing
      visibility into replication health.
