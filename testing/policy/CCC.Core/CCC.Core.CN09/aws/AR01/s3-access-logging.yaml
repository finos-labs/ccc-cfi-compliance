name: S3 Server Access Logging Configuration
service_type: object-storage
requirement_text: >
  When the service is operational, its logs and any child resource logs MUST NOT 
  be accessible from the resource they record access to.

validity_score: 7
validity_commentary: >
  This query validates that S3 server access logging is configured to write
  to a separate bucket. Strengths:
  - Validates logging is enabled and configured
  - Target bucket separation ensures logs are not accessible from source
  - Log delivery is managed by S3, not the source bucket owner
  Limitations:
  - Does not validate target bucket permissions or policies
  - Does not verify target bucket is in a separate account (stronger isolation)
  - Log delivery can be disabled by bucket owner
  - Does not validate CloudTrail data events (more comprehensive logging)
  - Target bucket ACLs/policies must be verified separately

query: |
  aws s3api get-bucket-logging \
    --bucket ${BUCKET_NAME}

rules:
  - jsonpath: "$.LoggingEnabled.TargetBucket"
    expected_values: []
    validation_rule: "^(?!${BUCKET_NAME}$)[a-z0-9][a-z0-9.-]{1,61}[a-z0-9]$"
    description: >
      Validates that access logging is enabled and the target bucket is different
      from the source bucket. Logs stored in the same bucket would violate the
      integrity requirement.

  - jsonpath: "$.LoggingEnabled.TargetPrefix"
    expected_values: []
    validation_rule: "^.+$"
    description: >
      Validates that a log prefix is configured. A prefix helps organize logs
      and can include bucket name or date patterns for easier management.
