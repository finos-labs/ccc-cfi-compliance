name: GCP HTTPS Load Balancer TLS 1.3 Policy Check
service_type: load-balancer
requirement_text: >
  When a port is exposed for non-SSH network traffic, all traffic MUST include 
  a TLS handshake AND be encrypted using TLS 1.3 or higher.

validity_score: 7
validity_commentary: >
  This query validates TLS policy configuration on GCP HTTPS Load Balancers.
  GCP SSL policies define minimum TLS versions and cipher suites. Gaps include:
  - Does not validate TLS for direct VM connections bypassing the load balancer
  - Does not verify backend encryption
  - Only checks declared policy, not actual TLS negotiation behavior

query: |
  gcloud compute ssl-policies describe ${ResourceName} \
    --project=${GCPProjectID} \
    --format=json

rules:
  - jsonpath: "$.minTlsVersion"
    expected_values:
      - "TLS_1_3"
    validation_rule: "^TLS_1_3$"
    description: >
      Verifies that the minimum TLS version is set to TLS 1.3.
      This ensures all connections use TLS 1.3 or higher.

  - jsonpath: "$.profile"
    expected_values:
      - "RESTRICTED"
      - "MODERN"
      - "CUSTOM"
    validation_rule: "^(RESTRICTED|MODERN|CUSTOM)$"
    description: >
      Validates the SSL policy profile. RESTRICTED and MODERN profiles
      provide strong security defaults.
