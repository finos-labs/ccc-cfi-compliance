name: GCP Cloud KMS Key Rotation (180 days)
service_type: object-storage
requirement_text: >
  When encryption keys are used, the service MUST rotate active keys within 
  180 days of issuance.

validity_score: 7
validity_commentary: >
  This query checks if GCP Cloud KMS automatic key rotation is configured.
  GCP KMS supports configurable automatic rotation periods. Strengths:
  - GCP allows configurable rotation periods
  - Key rotation is automatic when configured
  - Rotation period directly satisfies the requirement
  Limitations:
  - Rotation period must be explicitly configured
  - Does not verify actual rotation has occurred

query: |
  gcloud kms keys describe ${GCPKMSKey} \
    --keyring=${GCPKMSKeyRing} \
    --location=${GCPKMSLocation} \
    --project=${GCPProjectID} \
    --format=json

rules:
  - jsonpath: "$.rotationPeriod"
    expected_values: []
    validation_rule: "^[0-9]+s$"
    description: >
      Verifies that automatic key rotation is configured. The value is in
      seconds. 180 days = 15552000 seconds.

  - jsonpath: "$.nextRotationTime"
    expected_values: []
    validation_rule: "^[0-9]{4}-[0-9]{2}-[0-9]{2}T.*$"
    description: >
      Confirms the next rotation time is scheduled, indicating rotation
      is active.
