name: KMS Key Automatic Rotation (365 days)
service_type: object-storage
requirement_text: >
  When encryption keys are used, the service MUST rotate active keys within 
  365 days of issuance.

validity_score: 8
validity_commentary: >
  This query validates that KMS automatic key rotation is enabled. AWS KMS
  automatic rotation occurs annually (365 days), which directly satisfies
  this requirement. Strengths:
  - AWS KMS automatic rotation is exactly 365 days
  - Rotation is handled automatically by AWS
  - Old key material is retained for decryption
  Limitations:
  - Only applies to symmetric CMKs
  - Asymmetric keys and imported key material cannot use automatic rotation
  - Does not track actual last rotation date

query: |
  aws kms get-key-rotation-status \
    --key-id ${KMS_KEY_ID}

rules:
  - jsonpath: "$.KeyRotationEnabled"
    expected_values:
      - true
    validation_rule: "^true$"
    description: >
      Verifies that automatic key rotation is enabled. AWS KMS rotates keys
      every 365 days when enabled, satisfying the annual rotation requirement.
