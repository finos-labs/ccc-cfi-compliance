name: Azure Storage Account Soft Delete and Versioning Configuration
service_type: object-storage
requirement_text: >
  When an entity attempts to modify the service through a user interface, the 
  authentication process MUST require multiple identifying factors for authentication.

validity_score: 5
validity_commentary: >
  Azure does not have a direct equivalent to S3 MFA Delete at the storage level.
  MFA in Azure is enforced at the Azure AD/Entra ID level for all operations.
  This check validates soft delete and versioning as compensating controls.
  Strengths:
  - Soft delete allows recovery of deleted blobs
  - Versioning preserves all blob versions
  - Azure AD MFA applies to all authenticated operations
  Limitations:
  - This is NOT a direct MFA-for-delete check
  - MFA enforcement is at the identity layer, not storage layer
  - Soft delete only protects for the retention period
  - For true MFA enforcement, Azure AD Conditional Access policies should be verified

query: |
  az storage account blob-service-properties show \
    --account-name ${AzureStorageAccount} \
    --resource-group ${AzureResourceGroup} \
    --query "{softDeleteEnabled: deleteRetentionPolicy.enabled, softDeleteDays: deleteRetentionPolicy.days, versioningEnabled: isVersioningEnabled}" \
    --output json

rules:
  - jsonpath: "$.softDeleteEnabled"
    expected_values:
      - true
    validation_rule: "^true$"
    description: >
      Verifies that blob soft delete is enabled. This allows recovery of deleted
      blobs within the retention period, providing protection against accidental
      or malicious deletion.

  - jsonpath: "$.softDeleteDays"
    expected_values: []
    validation_rule: "^[7-9]|[1-9][0-9]+$"
    description: >
      Verifies that soft delete retention is at least 7 days.
      Higher values provide longer recovery windows.

  - jsonpath: "$.versioningEnabled"
    expected_values:
      - true
    validation_rule: "^true$"
    description: >
      Verifies that blob versioning is enabled. Versioning preserves all
      previous versions of blobs, enabling recovery from modifications.
